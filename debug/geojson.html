<!DOCTYPE html>
<html>

<head>
    <title>Mapbox GL JS debug page</title>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel='stylesheet' href='/dist/mapbox-gl.css' />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        html,
        body,
        #map {
            height: 100%;
        }

        #controls {
            position: absolute;
            top: 0;
            z-index: 10;
            background: black;
        }
    </style>
</head>

<body>
    <div id="controls"><button id="next">Next</button></div>
    <div id='map'></div>

    <script src='/dist/mapbox-gl-dev.js'></script>
    <script src='/debug/access_token_generated.js'></script>
    <script>

        async function loadData() {
            const bayZips = await (await fetch("./bay-zips.json")).json();
            const docLand = await (await fetch("./doc-land.json")).json();
            console.log("done loading");
            window.data = [(bayZips), (docLand)];
            return window.data;
        }

        function createMap(data) {
            console.log(data);
            
            var style = {
                "version": 8,
                "sources": {
                    // "satellite": {
                    //     "type": "raster",
                    //     "url": "mapbox://mapbox.satellite",
                    //     "tileSize": 256
                    // },
                    "gb-source": {
                        "type": "geojson",
                        "data": data
                    },
                },
                "layers": [{
                    "id": "background",
                    "type": "background",
                    "paint": {
                        "background-color": "rgb(128,128,128)"
                    }
                },
                // {
                //     "id": "satellite",
                //     "type": "raster",
                //     "source": "satellite"
                // },
                {
                    "id": "gb-layer",
                    "type": "line",
                    "source": "gb-source",
                    layout: {
                        'line-cap': 'round',
                        'line-join': 'round'
                    },
                    paint: {
                        'line-color': '#F00',
                        'line-width': 1
                    },
                }]};

            var map = new mapboxgl.Map({
                container: 'map',
                minZoom: 0,
                zoom: 6,
                center: [169.085390533001004, -44.305483364604399],
                bearing: 0,
                style: style,
                hash: false
            });
            return map;
        }

        async function run() {
            const data = await loadData();
            let i = 0;
            const map = createMap(data[0]);
            document.getElementById("next").addEventListener("click", () => {
                i = (i + 1) % data.length;
                console.log(i, data[i]);
                map.getSource("gb-source").setData(data[i])
            });
        }

        run();

    </script>
</body>

</html>